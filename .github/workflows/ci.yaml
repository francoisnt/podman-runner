name: CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v5 

      - name: Install Podman
        run: |
          sudo apt-get update
          sudo apt-get install -y podman
          # Start rootless socket for container runs
          systemctl --user start podman.socket
          podman system migrate  # One-time setup for storage

      - name: Setup uv
        uses: astral-sh/setup-uv@v6 
        with:
          version: "0.9.11"  

      - name: Install dependencies
        run: uv sync --all-extras --locked

      - name: Run unit tests
        run: uv run task unit 

      - name: Run integration tests
        run: uv run task integration  